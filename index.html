<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recall Customer Notification Letter Generator</title>
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="header-container">
            <div class="logo-container">
                <img src="Company_logo.png" alt="Company Logo" class="main-logo">
            </div>
            <div class="title-container">
                <h1>Recall Customer Notification Letter Generator</h1>
            </div>
            <div id="google_translate_element" class="translate-container"></div>
            <div class="nav-links-container">
                <a href="" class="home-link">Home</a>
                <button id="settingsBtn" class="help-link" title="Settings">‚öôÔ∏è</button>
                <a href="instructions.html" class="help-link" target="_blank">?</a>
                <button id="nextRevisionsBtn" class="help-link" title="Next Revisions">üìù</button>
            </div>
        </div>
        
        <div class="section">
            <h2>Enter Recall Information</h2>
            <table class="recall-info-table">
                <tr>
                    <td>
                        <div class="form-group">
                            <label for="recallDate">Recall Date:</label>
                            <input type="date" id="recallDate" required>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <label for="manufacturer">Manufacturer:</label>
                            <input type="text" id="manufacturer" required>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <label for="ncr">NCR:</label>
                            <input type="text" id="ncr" required>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="form-group">
                            <label for="materialCategory">Material Category:</label>
                            <input type="text" id="materialCategory" required>
                        </div>
                    </td>
                    <td>
                         <div class="form-group">
                            <label for="issue">Issue:</label>
                            <input type="text" id="issue" required>
                        </div>
                    </td>
                    <td>
                        <div class="form-group">
                            <label for="heatNumber">Heat Number:</label>
                            <input type="text" id="heatNumber">
                        </div>
                    </td>
                </tr>
            </table>

            <!-- New custom fields -->
            <div class="custom-fields-section">
                <h3>Custom Fields</h3>
                <p class="field-hint">These fields can be inserted into letter content using [FIELD1], [FIELD2], etc.</p>
                <div class="form-group">
                    <label for="customField1">Field 1:</label>
                    <input type="text" id="customField1">
                </div>
                <div class="form-group">
                    <label for="customField2">Field 2:</label>
                    <input type="text" id="customField2">
                </div>
                <div class="form-group">
                    <label for="customField3">Field 3:</label>
                    <input type="text" id="customField3">
                </div>
                <div class="form-group">
                    <label for="customField4">Field 4:</label>
                    <input type="text" id="customField4">
                </div>
                <div class="form-group">
                    <label for="customField5">Field 5:</label>
                    <input type="text" id="customField5">
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Letter Content</h2>
            <div class="form-group">
                <label for="letterTitle">Letter Title:</label>
                <input type="text" id="letterTitle" value="PRODUCT ADVISORY NOTIFICATION">
            </div>
            <div class="form-group">
                <label for="paragraph1">Paragraph 1:</label>
                <textarea id="paragraph1" rows="3">Company has been notified by the manufacturer, [MANUFACTURER], that the following [MATERIAL_CATEGORY] were [ISSUE].</textarea>
            </div>
            <div class="form-group">
                <label for="paragraph2">Paragraph 2:</label>
                <textarea id="paragraph2" rows="3">Our records indicate that Company supplied your company this product on the following orders.</textarea>
            </div>
            <div class="form-group">
                <label for="paragraph3">Paragraph 3:</label>
                <textarea id="paragraph3" rows="3">Please quarantine these [MATERIAL_CATEGORY] and contact your local Company sales representative to request return material authorization.</textarea>
            </div>
            <div class="form-group">
                <label for="paragraph4">Paragraph 4:</label>
                <textarea id="paragraph4" rows="3">We apologize for any inconvenience this may cause and appreciate your assistance with this matter.</textarea>
            </div>
            <div class="form-group">
                <label for="paragraph5">Paragraph 5:</label>
                <textarea id="paragraph5" rows="3">For inquiries, please contact your local Sales and Service Representative or the Company Quality Department</textarea>
            </div>
            <div class="form-group">
                <label for="contactInfo">Contact Information:</label>
                <textarea id="contactInfo" rows="2"></textarea>
            </div>
            
            <!-- New content override section with rich text support -->
            <div class="content-override-section">
                <div class="form-group override-header">
                    <input type="checkbox" id="useContentOverride" class="override-checkbox">
                    <label for="useContentOverride">Override Letter Content</label>
                    <p class="field-hint">When checked, the text below will replace all paragraphs in the generated letters.</p>
                </div>
                <div class="form-group">
                    <label for="contentOverride">Custom Letter Content:</label>
                    <textarea id="contentOverride" rows="8" class="override-textarea">
To Whom It May Concern:

Company has been notified by the manufacturer, [MANUFACTURER], that the following [MATERIAL_CATEGORY] were [ISSUE].

Heat Number: [HEAT_NUMBER]

Our records indicate that Company supplied your company this product on the following orders.

[FIELD1]
[FIELD2]
[FIELD3]

Please contact your local Company sales representative at your earliest convenience.

Regards,
[FIELD4]
[FIELD5]</textarea>
                </div>
            </div>
        </div>
        
        <div class="section">
            <h2>Upload Logo</h2>
            <div class="form-group">
                <label for="logoUpload">Company Logo:</label>
                <input type="file" id="logoUpload" accept="image/*">
            </div>
            <div id="logoPreview"></div>
        </div>
        
        <div class="section">
            <h2>Import Customer Data</h2>
            <div class="form-group">
                <label for="csvUpload">CSV File:</label>
                <input type="file" id="csvUpload" accept=".csv">
            </div>
            
            <div id="fieldSelection" class="hidden">
                <h3>Choose Fields to Display</h3>
                <div id="fieldCheckboxes"></div>
            </div>
            
            <div class="form-group">
                <h3>Group Letters By:</h3>
                <div class="radio-group">
                    <input type="radio" id="groupByControl" name="groupBy" value="Control" checked>
                    <label for="groupByControl">Control Number</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="groupByItemAddress" name="groupBy" value="ItemAddress">
                    <label for="groupByItemAddress">Item ID & Address</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="groupBySSR" name="groupBy" value="SSR">
                    <label for="groupBySSR">Sales Representative</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="groupByItemOrder" name="groupBy" value="ItemOrder">
                    <label for="groupByItemOrder">Item ID & Customer Order</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="groupByLine" name="groupBy" value="Line">
                    <label for="groupByLine">Individual Line Items</label>
                </div>
            </div>
            
            <button id="generateBtn" class="btn">Generate Letters</button>
        </div>
        
        <div id="lettersContainer" class="hidden">
            <div class="letters-header">
                <h2>Generated Letters</h2>
                <div class="buttons-container">
                    <button id="printBtn" class="btn">Print Letters</button>
                    <button id="printIndividuallyBtn" class="btn">Print Letters Individually</button>
                    <button id="exportBtn" class="btn">Export as ZIP</button>
                    <button id="saveAsImagesBtn" class="btn">Save as Images</button>
                </div>
            </div>
            <div id="letters"></div>
        </div>
    </div>
    
    <!-- Settings / Release Notes Modal -->
    <div id="settingsModal" class="modal hidden">
      <div class="modal-content">
        <span class="close" id="closeSettingsModal">&times;</span>
        <h2>Release Notes for Recall Customer Notification Letter Generator</h2>
        <p><strong>Version:</strong> 1.0.0</p>
        <p><strong>Release Date:</strong> October 2023</p>
        <h3>1. Overview</h3>
        <p>This is the initial release of the Recall Customer Notification Letter Generator, a tool designed to streamline the process of creating and distributing recall letters. It allows users to import customer data from a CSV file, customize letter content with rich text formatting, and generate professional letters that can be printed or exported in various digital formats.</p>
        <h3>2. New Features</h3>
        <ul>
            <li><strong>Letter Generation from CSV:</strong> Import customer data via a CSV file to automatically populate and generate multiple recall letters.</li>
            <li><strong>Rich Text Editing:</strong> Customize all paragraphs and the contact section with formatting options like bold, italics, underline, lists, and font colors.</li>
            <li><strong>Dynamic Placeholders:</strong> Use placeholders like <code>[MANUFACTURER]</code>, <code>[MATERIAL_CATEGORY]</code>, and <code>[FIELD1-5]</code> to dynamically insert information into letters.</li>
            <li><strong>Full Content Override:</strong> For maximum flexibility, users can replace the default paragraph structure with their own custom letter content.</li>
            <li><strong>Flexible Data Grouping:</strong> Group generated letters by Control Number, Sales Rep, or other criteria to organize communication effectively.</li>
            <li><strong>Multiple Export Options:</strong> Export all generated letters as a single ZIP file containing individual PDFs, JPG images, or TXT files.</li>
            <li><strong>Live Editing:</strong> Directly edit the content of any generated letter on the page before printing or exporting.</li>
            <li><strong>Custom Logo Support:</strong> Upload a company logo to be automatically included in the header of each letter.</li>
        </ul>
        <h3>3. Improvements</h3>
        <ul>
            <li><strong>Client-Side Processing:</strong> All data is processed locally in your browser for enhanced privacy and security. No customer or recall data is ever uploaded to a server.</li>
            <li><strong>Intuitive User Interface:</strong> A clean, step-by-step layout guides you through the process of creating letters.</li>
        </ul>
        <h3>4. Bug Fixes</h3>
        <ul>
            <li>Initial public release. No bug fixes to report.</li>
        </ul>
        <h3>5. Known Issues</h3>
        <ul>
            <li><strong>Performance:</strong> Generating a very large number of letters (e.g., hundreds) as PDFs or images may take some time and consume system resources.</li>
            <li><strong>Translation:</strong> The integrated Google Translate feature may not perfectly translate all UI components and can occasionally affect page layout. A "Restore Original Language" button is provided.</li>
        </ul>
        <h3>6. Deprecations & Removals</h3>
        <ul>
            <li>No features have been deprecated or removed in this version.</li>
        </ul>
        <h3>7. Security Updates</h3>
        <ul>
            <li><strong>Client-Side Data Handling:</strong> To ensure data privacy, all imported CSV data, logos, and letter content are processed entirely within your web browser and are not uploaded or stored on any external server.</li>
        </ul>
        <h3>8. Compatibility</h3>
        <ul>
            <li><strong>Browser Support:</strong> Recommended for use on modern desktop browsers such as Chrome, Firefox, Safari, and Edge.</li>
            <li><strong>Operating System:</strong> Compatible with any desktop operating system (Windows, macOS, Linux) that runs a supported browser.</li>
        </ul>
        <h3>9. Upgrade Instructions</h3>
        <ol>
            <li>This is a web-based application, so no installation is required.</li>
            <li>To ensure you have the latest version, simply refresh the page in your browser.</li>
            <li>If you experience issues after an update, clearing your browser's cache is recommended.</li>
        </ol>
        <h3>10. Contact Information</h3>
        <ul>
          <li><strong>Support:</strong> For bug reports or feature requests, please contact the development team.</li>
          <li><strong>Help Documentation:</strong> <a href="instructions.html" target="_blank">Click here for instructions.</a></li>
        </ul>
      </div>
    </div>

    <!-- Next Revisions Feedback Modal -->
    <div id="nextRevisionsModal" class="modal hidden">
      <div class="modal-content">
        <span class="close" id="closeNextRevisionsModal">&times;</span>
        <h2>Next Revisions Feedback</h2>
        <ul>
          <li>Validation currently uses blocking alerts; consider inline form validation messages.</li>
          <li>CSV parsing errors show a generic alert; it would be helpful to indicate row/column of failure.</li>
          <li>No loader or progress indicator during initial letter generation; large data sets can feel unresponsive.</li>
          <li>Standard paragraphs do not replace <code>[HEAT_NUMBER]</code> when the field is blank.</li>
          <li>Override content textarea uses raw HTML in value‚Äîpreview may differ from actual letter output.</li>
          <li>Multi-line addresses lose line breaks in the generated letter header.</li>
          <li>Custom fields and placeholder replacements are not sanitized‚Äîpotential XSS/security risk.</li>
          <li>Grouping by Sales Representative generated duplicate letters when multiple records share the same rep‚ÄîgroupBy logic needs review.</li>
          <li>Custom fields insertion tested with sample data: empty values leave leftover tags or extra blank lines; handle missing fields gracefully.</li>
          <li>Exported text reports (ZIP) lose table alignment and some files were empty with large data sets; improve report export reliability.</li>
          <li>Recall inputs accept invalid dates and empty required fields until generation; add inline validation to prevent errors.</li>
        </ul>
      </div>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="script.js"></script>
    
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE
            }, 'google_translate_element');
        }
    </script>
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>
</body>
</html>
